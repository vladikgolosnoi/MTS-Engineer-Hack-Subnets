# Белый список подсетей для защиты ресурсов МТС

Проект подготовлен в рамках кейса MTS Engineer Hack.

## 1. Описание решения
Скрипт `aggregate_subnets.py` формирует оптимизированный белый список IPv4-подсетей по историческим логам трафика без DDoS. Используется динамическое программирование с релаксацией Лагранжа над двоичным префиксным деревом. Поиск множителя λ осуществляется двоичным поиском, что позволяет удержать число подсетей ≤ 64 000 при минимальном количестве «лишних» адресов.

Основные свойства:
- полностью воспроизводимый результат (используются детерминированные структуры данных);
- время работы < 15 минут на ноутбуке с 4 vCPU / 8 GB RAM;
- все легитимные IP из логов сохраняются;
- штраф за лишние адреса минимизирован в рамках выбранной модели (0.05 за IP).

## 2. Требования к окружению
- Python ≥ 3.10;
- свободно ~1.2 GB RAM и ~1.2 GB свободного места на диске (логи + выходные данные);
- пакеты из стандартной библиотеки (доп. зависимости не нужны).

## 3. Запуск скрипта
```bash
./aggregate_subnets.py logs_ips_2025_09_19_17_11.txt subnets.txt
```
По умолчанию используются параметры:
- предел подсетей: 64 000;
- штраф за лишний адрес: 0.05;
- минимальная глубина дерева: /31.

Необязательные параметры (см. `--help`):
- `--base-prefix` — глубина листьев DP;
- `--limit` — максимум подсетей в выходном списке;
- `--penalty` — штраф за один лишний IP;
- `--iterations` — число итераций двоичного поиска λ.

## 4. Полученные результаты
- уникальные IPv4 из логов: 4 186 268;
- итоговые подсети: 63 981 (формат CIDR);
- лишние IPv4 адреса: 1 257 215 280;
- штраф: 62 860 764.00;
- файл с подсетями: `subnets.txt` (размер ≈ 1.0 MB).

## 5. Воспроизводимость
При повторном запуске на тех же логах скрипт создаёт идентичный `subnets.txt`. Решение не использует случайности и не обращается к сети.

## 6. Структура репозитория
- `aggregate_subnets.py` — главный скрипт агрегации;
- `logs_ips_2025_09_19_17_11.txt` — предоставленный лог-файл (исходные данные);
- `subnets.txt` — результат агрегации (белый список);
- `README.md` — текущий документ;
- `report.pdf` — аналитический отчёт (1–3 страницы).

## 7. Проверка
Рекомендуемые проверки после изменений:
1. Запустить скрипт и убедиться, что количество строк в `subnets.txt` ≤ 64 000.
2. При необходимости провести дополнительный анализ (сравнение с предыдущими версиями, оценка штрафа).

## 8. Контакты
Команда/участник: Владислав Голосной.
